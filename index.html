<!DOCTYPE html>
<html lang="ar" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>حجز موعد</title>
  <style>
    :root{
      --blue:#0d6efd;
      --green:#27ae60;
      --red:#e74c3c;
      --grey:#c9ced6;
      --text:#222;
      --muted:#666;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; color:var(--text); background:#fff;
    }
    .container{
      max-width:980px; margin:24px auto 48px; padding:0 16px;
    }
    header{ text-align:center; margin:8px 0 24px;}
    header h2{font-weight:600; letter-spacing:.2px;}

    .grid{ display:grid; grid-template-columns:300px 1fr; gap:26px; align-items:start;}

    /* Calendar */
    .calendar{ border:1px solid #e6e8eb; border-radius:8px; overflow:hidden;}
    .cal-head{ display:flex; justify-content:space-between; align-items:center; padding:10px 12px; background:#f8f9fb; border-bottom:1px solid #e6e8eb;}
    .cal-head .month{ font-weight:600; color:#0b0f19;}
    .nav-btn{ background:transparent; border:0; font-size:18px; padding:6px 8px; cursor:pointer; color:#334155}

    .weekdays, .days{ display:grid; grid-template-columns:repeat(7,1fr);}
    .weekdays{ background:#f8f9fb; border-bottom:1px solid #e6e8eb;}
    .weekdays span{ text-align:center; padding:8px 0; font-size:12px; color:#6b7280;}

    .days button{ height:36px; border:0; border-right:1px solid #f0f2f5; border-bottom:1px solid #f0f2f5; background:#fff; font-weight:500; cursor:pointer; position:relative;}
    .days button:nth-child(7n){ border-right:0; }
    .days button.is-empty{ background:#fafafa; color:#9aa3af; cursor:default;}
    .days button.available{ background:#0a7e28; color:#fff;}
    .days button.unavailable{ background:#d62c20; color:#fff;}
    .days button.selected{ background:#0a58ca; color:#fff; box-shadow:inset 0 0 0 2px rgba(255,255,255,.4)}

    /* Legend */
    .legend{ display:flex; gap:16px; align-items:center; padding:10px 12px; font-size:13px; color:#475569}
    .dot{ width:8px; height:8px; border-radius:50%; display:inline-block; margin-inline-end:6px;}
    .dot.green{ background:#0a7e28}
    .dot.red{ background:#d62c20}
    .dot.blue{ background:#0a58ca}
    .dot.grey{ background:#9aa3af}

    /* Slots */
    .panel{ border:1px solid #e6e8eb; border-radius:8px; padding:12px;}
    .slots{ list-style:none; margin:0; padding:2px 0; display:flex; flex-direction:column; gap:10px;}
    .slot{ display:flex; align-items:center; justify-content:space-between; border:1px solid #eef0f3; border-radius:8px; padding:10px 12px; cursor:not-allowed; color:#c53b30;}
    .slot .left{ display:flex; align-items:center; gap:10px;}
    .bullet{ width:8px; height:8px; border-radius:50%; background:#d62c20 }
    .slot small{ color:#9aa3af }
    .slot.available{ color:#177245; border-color:#dff3e6; cursor:pointer;}
    .slot.available .bullet{ background:#0a7e28 }
    .slot.selected{ outline:2px solid #0a58ca;}

    /* Footer button */
    .footer{ margin-top:20px; display:flex; justify-content:center}
    .book-btn{ background:#0a58ca; color:#fff; border:0; padding:12px 28px; border-radius:8px; font-weight:700; letter-spacing:.3px; cursor:not-allowed; opacity:.5;}
    .book-btn.ready{ cursor:pointer; opacity:1 }

    /* tiny helper */
    .muted{ color:#64748b; font-size:12px;}

    @media (max-width:760px){
      .grid{ grid-template-columns:1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div style="font-size:18px; color:#94a3b8;">-</div>
      <h2>Select an available date and time slot</h2>
    </header>

    <div class="grid">
      <!-- Calendar -->
      <section class="calendar" aria-label="Calendar">
        <div class="cal-head">
          <button class="nav-btn" id="prevMo" aria-label="Previous month">&#8249;</button>
          <div class="month" id="monthLabel">novembre 2025</div>
          <button class="nav-btn" id="nextMo" aria-label="Next month">&#8250;</button>
        </div>
        <div class="weekdays">
          <span>lu</span><span>ma</span><span>me</span><span>gi</span><span>ve</span><span>sa</span><span>do</span>
        </div>
        <div class="days" id="days"></div>
        <div class="legend">
          <span><i class="dot green"></i>Available</span>
          <span><i class="dot red"></i>Not available</span>
          <span><i class="dot blue"></i>Day selected</span>
          <span><i class="dot grey"></i>Days not configured</span>
        </div>
      </section>

      <!-- Time slots -->
      <section class="panel">
        <ul class="slots" id="slotList"></ul>
        <div class="muted" id="noSlots" style="display:none">لا توجد أوقات متاحة لهذا اليوم.</div>
      </section>
    </div>

    <div class="footer">
      <button class="book-btn" id="bookBtn">BOOK</button>
    </div>
  </div>

  <script>
    /* ====== Demo data to mimic the screenshot ====== */
    const demoMonth = { year: 2025, monthIndex: 10 }; // 0-based -> 10 = November
    // Calendar coloring like the screenshot (green: 24,25,27)
    const availableDays = new Set([24,25,27]);

    // Time slots for the selected day (only 09:00-09:15 available)
    const baseSlots = [
      { t:"09:30 - 09:45", n:0 },
      { t:"09:00 - 09:15", n:1 },
      { t:"10:00 - 10:15", n:0 },
      { t:"11:00 - 11:15", n:0 },
      { t:"12:00 - 12:15", n:0 },
      { t:"12:30 - 12:45", n:0 },
    ];

    /* ====== Elements ====== */
    const daysEl = document.getElementById('days');
    const monthLabel = document.getElementById('monthLabel');
    const slotList = document.getElementById('slotList');
    const bookBtn = document.getElementById('bookBtn');
    const noSlots = document.getElementById('noSlots');

    let selectedDay = null; // number (24/25/27)
    let selectedSlotIndex = null;

    function renderMonth({year, monthIndex}){
      const date = new Date(year, monthIndex, 1);
      const monthName = date.toLocaleDateString('fr-IT',{month:'long'}); // "novembre"
      monthLabel.textContent = `${monthName} ${year}`;

      // compute leading blanks (Mon-first like screenshot)
      const firstDay = (date.getDay() + 6) % 7; // make Monday=0
      const daysInMonth = new Date(year, monthIndex+1, 0).getDate();

      daysEl.innerHTML = '';
      // previous/next month blanks (as grey)
      for(let i=0;i<firstDay;i++){
        const b = document.createElement('button');
        b.className = 'is-empty';
        b.disabled = true; b.textContent = '';
        daysEl.appendChild(b);
      }
      for(let d=1; d<=daysInMonth; d++){
        const btn = document.createElement('button');
        btn.textContent = d;
        const isAvail = availableDays.has(d);
        btn.className = isAvail ? 'available' : 'unavailable';
        btn.disabled = !isAvail;
        btn.addEventListener('click', ()=> selectDay(d));
        if(selectedDay === d) btn.classList.add('selected');
        daysEl.appendChild(btn);
      }

      // Fill tail to complete grid (optional)
      const cells = daysEl.children.length;
      const tail = (Math.ceil(cells/7)*7) - cells;
      for(let i=0;i<tail;i++){
        const b = document.createElement('button');
        b.className = 'is-empty'; b.disabled = true; daysEl.appendChild(b);
      }
    }

    function selectDay(day){
      selectedDay = day; selectedSlotIndex = null;
      [...daysEl.children].forEach(el=> el.classList.toggle('selected', el.textContent==day));
      renderSlots();
      lockBook();
    }

    function renderSlots(){
      slotList.innerHTML = '';
      const slots = baseSlots.map(s=>({...s}));
      // If the day is 24/25/27, keep the data; else none (but those days are only enabled)
      if(!selectedDay){ noSlots.style.display='block'; return; }
      noSlots.style.display='none';
      slots.forEach((s, idx)=>{
        const li = document.createElement('li');
        li.className = 'slot' + (s.n>0? ' available' : '');
        li.innerHTML = `
          <div class="left"><span class="bullet"></span><span>${s.t}</span></div>
          <small>(${s.n})</small>
        `;
        if(s.n>0){
          li.tabIndex = 0;
          li.addEventListener('click', ()=> selectSlot(idx));
        }
        slotList.appendChild(li);
      });
    }

    function selectSlot(i){
      selectedSlotIndex = i;
      [...slotList.children].forEach((li, idx)=> li.classList.toggle('selected', idx===i));
      unlockBook();
    }

    function lockBook(){ bookBtn.classList.remove('ready'); bookBtn.disabled = true; }
    function unlockBook(){ bookBtn.classList.add('ready'); bookBtn.disabled = false; }

    bookBtn.addEventListener('click', async ()=>{
      if(bookBtn.disabled) return;
      const slot = baseSlots[selectedSlotIndex];
      const payload = {
        date: `${selectedDay} ${monthLabel.textContent}`,
        time: slot.t,
      };

      // ===== Optional: Send to Telegram (client-side) =====
      // !!! تحذير: لا تضع التوكن الحقيقي في كود الواجهة الأمامية العام !!!
      // استعمل خادماً وسيطاً (Serverless function) أو استبدل القيمتين أدناه مؤقتاً خلال التطوير فقط.
      const BOT_TOKEN = "7544882164:AAHUQCd3fnHSwbj6tSPIGSEbRgkOXS3wLTY"; // ⚠️ لا تضع التوكن الحقيقي هنا إذا كان الموقع عاماً
      const CHAT_ID = "6494466799";

      try{
        if(BOT_TOKEN !== 'PASTE_YOUR_BOT_TOKEN'){
          const res = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`,{
            method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({ chat_id: CHAT_ID, text: `حجز جديد: ${payload.date} — ${payload.time}` })
          });
          if(!res.ok) throw new Error('Telegram error');
          alert('✅ تم تأكيد الحجز وإرسال إشعار.');
        }else{
          alert(`✅ تم تأكيد الحجز (تجريبي)\n${payload.date} — ${payload.time}`);
        }
      }catch(e){
        console.error(e);
        alert('⚠️ حدث خطأ أثناء الإرسال، تم تأكيد الحجز محلياً.');
      }
    });

    // init to match screenshot (no selection yet)
    renderMonth(demoMonth);
    renderSlots();

    // Disable real month navigation (demo only)
    document.getElementById('prevMo').addEventListener('click',()=>{})
    document.getElementById('nextMo').addEventListener('click',()=>{})
  </script>
</body>
</html>
